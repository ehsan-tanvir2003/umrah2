<div class="flex h-screen bg-gray-100">
  <!-- Sidebar -->
  <aside class="w-64 bg-gray-800 text-white flex flex-col">
    <div class="h-16 flex items-center justify-center text-2xl font-bold border-b border-gray-700">
      <svg class="h-8 w-8 mr-2 text-teal-400" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M18.33,3H5.67A2.67,2.67,0,0,0,3,5.67V18.33A2.67,2.67,0,0,0,5.67,21H18.33A2.67,2.67,0,0,0,21,18.33V5.67A2.67,2.67,0,0,0,18.33,3ZM9,17.5H5.5V10.5H9Zm6.5,0H12V10.5h3.5ZM18.5,9H5.5V5.5h13Z"/></svg>
      Umrah<span class="text-teal-400">Flow</span>
    </div>
    <nav class="flex-1 px-4 py-6 space-y-1 overflow-y-auto">
      <a routerLink="/dashboard" routerLinkActive="bg-gray-900" [routerLinkActiveOptions]="{exact: true}" class="flex items-center px-4 py-2 text-gray-300 hover:bg-gray-700 hover:text-white rounded-md transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>
        Dashboard
      </a>
      
      <!-- Visitor Menu -->
       @if(authService.hasRole(['Super Admin', 'Branch Manager', 'Agent', 'Data Entry', 'Accountant'])) {
       <div>
        <button (click)="toggleVisitorMenu()" class="w-full flex items-center justify-between px-4 py-2 text-gray-300 hover:bg-gray-700 hover:text-white rounded-md transition-colors">
          <span class="flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 7a4 4 0 11-8 0 4 4 0 018 0zM9 14a6 6 0 00-6 6v1h12v-1a6 6 0 00-6-6z" /></svg>
            Visitor
          </span>
          <svg [class.rotate-90]="isVisitorMenuOpen()" class="h-5 w-5 transform transition-transform" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
        </button>
        @if(isVisitorMenuOpen()) {
          <div class="mt-1 pl-8 space-y-1">
            <a routerLink="/visitors" routerLinkActive="text-white" [routerLinkActiveOptions]="{exact: true}" class="block px-4 py-2 text-sm text-gray-400 hover:text-white rounded-md">All Visitors</a>
          </div>
        }
      </div>
      }

      <!-- Hajj Kafela Menu -->
      @if(authService.hasRole(['Super Admin', 'Branch Manager', 'Agent', 'Data Entry'])) {
      <div>
        <button (click)="toggleHajjMenu()" class="w-full flex items-center justify-between px-4 py-2 text-gray-300 hover:bg-gray-700 hover:text-white rounded-md transition-colors">
          <span class="flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3" viewBox="0 0 20 20" fill="currentColor"><path d="M5.5 2A3.5 3.5 0 002 5.5v2.879a.5.5 0 00.146.353l6.5 6.5a.5.5 0 00.708 0l6.5-6.5a.5.5 0 00.146-.353V5.5A3.5 3.5 0 0014.5 2h-9zM15 5.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z" /></svg>
            Hajj Kafela
          </span>
          <svg [class.rotate-90]="isHajjMenuOpen()" class="h-5 w-5 transform transition-transform" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
        </button>
        @if(isHajjMenuOpen()) {
          <div class="mt-1 pl-8 space-y-1">
            <a routerLink="/hajj/pre-registration" routerLinkActive="text-white" class="block px-4 py-2 text-sm text-gray-400 hover:text-white rounded-md">Pre-Registration</a>
            <a routerLink="/hajj/main-registration" routerLinkActive="text-white" class="block px-4 py-2 text-sm text-gray-400 hover:text-white rounded-md">Main Registration</a>
          </div>
        }
      </div>
      }

      <!-- Umrah Menu -->
      @if(authService.hasRole(['Super Admin', 'Branch Manager', 'Agent', 'Data Entry'])) {
       <div>
        <button (click)="toggleUmrahMenu()" class="w-full flex items-center justify-between px-4 py-2 text-gray-300 hover:bg-gray-700 hover:text-white rounded-md transition-colors">
          <span class="flex items-center">
             <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 2a1 1 0 00-1 1v1a1 1 0 002 0V3a1 1 0 00-1-1zM4 4a1 1 0 00-1 1v1a1 1 0 002 0V5a1 1 0 00-1-1zm12 0a1 1 0 00-1 1v1a1 1 0 002 0V5a1 1 0 00-1-1zM4 10a1 1 0 00-1 1v1a1 1 0 002 0v-1a1 1 0 00-1-1zm12 0a1 1 0 00-1 1v1a1 1 0 002 0v-1a1 1 0 00-1-1zM10 16a1 1 0 00-1 1v1a1 1 0 002 0v-1a1 1 0 00-1-1z" clip-rule="evenodd" /><path d="M3 10a7 7 0 1114 0v1a1 1 0 11-2 0v-1a5 5 0 10-10 0v1a1 1 0 11-2 0v-1z" /></svg>
            Umrah
          </span>
          <svg [class.rotate-90]="isUmrahMenuOpen()" class="h-5 w-5 transform transition-transform" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
        </button>
        @if(isUmrahMenuOpen()) {
          <div class="mt-1 pl-8 space-y-1">
            <a routerLink="/customers" routerLinkActive="text-white" class="block px-4 py-2 text-sm text-gray-400 hover:text-white rounded-md">All Umrah Clients</a>
            <a routerLink="/packages" routerLinkActive="text-white" class="block px-4 py-2 text-sm text-gray-400 hover:text-white rounded-md">Umrah Packages</a>
            <a routerLink="/groups" routerLinkActive="text-white" class="block px-4 py-2 text-sm text-gray-400 hover:text-white rounded-md">Group Management</a>
          </div>
        }
      </div>
      }

      @if(authService.hasRole(['Super Admin', 'Branch Manager', 'Data Entry'])) {
      <a routerLink="/students" routerLinkActive="bg-gray-900" class="flex items-center px-4 py-2 text-gray-300 hover:bg-gray-700 hover:text-white rounded-md transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M12 14l9-5-9-5-9 5 9 5z" /><path d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z" /><path stroke-linecap="round" stroke-linejoin="round" d="M12 14l9-5-9-5-9 5 9 5zm0 0l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14zm-4 6v-7.5l4-2.222 4 2.222V20" /></svg>
        Student Info
      </a>
      }
       @if(authService.hasRole(['Super Admin', 'Branch Manager', 'Data Entry'])) {
       <a routerLink="/manpower" routerLinkActive="bg-gray-900" class="flex items-center px-4 py-2 text-gray-300 hover:bg-gray-700 hover:text-white rounded-md transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>
        Manpower Management
      </a>
      }
      @if(authService.hasRole(['Super Admin', 'Branch Manager', 'Agent', 'Data Entry', 'Accountant'])) {
      <a routerLink="/visa" routerLinkActive="bg-gray-900" class="flex items-center px-4 py-2 text-gray-300 hover:bg-gray-700 hover:text-white rounded-md transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" /></svg>
        Visa Processing
      </a>
      }
      @if(authService.hasRole(['Super Admin', 'Branch Manager', 'Agent', 'Data Entry', 'Accountant'])) {
      <a routerLink="/passports" routerLinkActive="bg-gray-900" class="flex items-center px-4 py-2 text-gray-300 hover:bg-gray-700 hover:text-white rounded-md transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2z" /><path stroke-linecap="round" stroke-linejoin="round" d="M5 7V5a2 2 0 012-2h10a2 2 0 012 2v2" /></svg>
        Passport Processing
      </a>
      }
      @if(authService.hasRole(['Super Admin', 'Branch Manager', 'Agent', 'Data Entry', 'Accountant'])) {
      <a routerLink="/tickets" routerLinkActive="bg-gray-900" class="flex items-center px-4 py-2 text-gray-300 hover:bg-gray-700 hover:text-white rounded-md transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 5v2m0 4v2m0 4v2M5 5h14a2 2 0 012 2v3a2 2 0 000 4v3a2 2 0 01-2 2H5a2 2 0 01-2-2v-3a2 2 0 000-4V7a2 2 0 012-2z" /></svg>
        Ticket Management
      </a>
      }
      @if(authService.hasRole(['Super Admin', 'Branch Manager'])) {
      <a routerLink="/marketing" routerLinkActive="bg-gray-900" class="flex items-center px-4 py-2 text-gray-300 hover:bg-gray-700 hover:text-white rounded-md transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-2.236 9.168-5.514C18.335 1.036 18.665 1 19 1h.5a1.5 1.5 0 011.5 1.5v16.5a1.5 1.5 0 01-1.5 1.5h-1a2 2 0 01-2-2v-2.318a2.5 2.5 0 00-2.354-2.433l-2.478-.496A2.5 2.5 0 015.436 13.683z" /></svg>
        Marketing Management
      </a>
      }
      @if(authService.hasRole(['Super Admin', 'Branch Manager', 'Accountant', 'Read Only'])) {
      <a routerLink="/transactions" routerLinkActive="bg-gray-900" class="flex items-center px-4 py-2 text-gray-300 hover:bg-gray-700 hover:text-white rounded-md transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v.01" /></svg>
        Accounts
      </a>
      }
      @if(authService.hasRole(['Super Admin', 'Branch Manager', 'Accountant'])) {
      <a routerLink="/expenses" routerLinkActive="bg-gray-900" class="flex items-center px-4 py-2 text-gray-300 hover:bg-gray-700 hover:text-white rounded-md transition-colors">
        <svg class="w-6 h-6 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 14.25l6-6m4.5-3.493V21.75l-3.75-3.75-3.75 3.75-3.75-3.75-3.75 3.75V1.25L9 5.043l3.75-3.75L16.5 5.043 20.25 1.25Z" />
        </svg>
        Expenses
      </a>
      }
       @if(authService.hasRole(['Super Admin', 'Branch Manager', 'Accountant', 'Read Only'])) {
       <a routerLink="/reports" routerLinkActive="bg-gray-900" class="flex items-center px-4 py-2 text-gray-300 hover:bg-gray-700 hover:text-white rounded-md transition-colors">
        <svg class="w-6 h-6 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6a7.5 7.5 0 1 0 7.5 7.5h-7.5V6Z" />
          <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 10.5H21A7.5 7.5 0 0 0 13.5 3v7.5Z" />
        </svg>
        Reports
      </a>
      }
       @if(authService.hasRole(['Super Admin'])) {
       <a routerLink="/settings" routerLinkActive="bg-gray-900" class="flex items-center px-4 py-2 text-gray-300 hover:bg-gray-700 hover:text-white rounded-md transition-colors">
        <svg class="w-6 h-6 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75" />
        </svg>
        Settings
      </a>
      }
    </nav>
  </aside>

  <!-- Main content -->
  <main class="flex-1 flex flex-col overflow-hidden">
    <!-- Header -->
    <header class="h-16 bg-white border-b border-gray-200 flex items-center justify-between px-6">
      <h1 class="text-xl font-semibold text-gray-800">{{ pageTitle() }}</h1>
      <div class="flex-1 flex justify-center items-center space-x-4">
        <div class="flex items-center space-x-6 p-3 bg-gray-100 rounded-lg shadow-inner">
            <div class="text-center">
                <p class="text-sm font-semibold text-gray-800">{{ todayDate() }}</p>
            </div>
            <div class="w-px h-10 bg-gray-300"></div>
            <div class="flex flex-col space-y-1 text-sm">
                <div class="flex items-center space-x-2">
                    <span class="text-lg">ðŸ‡§ðŸ‡©</span>
                    <span class="font-mono text-gray-700 font-semibold">{{ bdTime() }}</span>
                    <span class="text-xs text-gray-500">BST</span>
                </div>
                <div class="flex items-center space-x-2">
                    <span class="text-lg">ðŸ‡¸ðŸ‡¦</span>
                    <span class="font-mono text-gray-700 font-semibold">{{ ksaTime() }}</span>
                    <span class="text-xs text-gray-500">AST</span>
                </div>
            </div>
        </div>
        <global-search></global-search>
      </div>
      <div class="flex items-center space-x-4">
        <div class="flex items-center space-x-2 text-sm">
            <label for="role-switcher" class="font-medium text-gray-600">View as:</label>
            <select id="role-switcher" [ngModel]="authService.currentUser()?.role" (change)="loginAs($event)" class="border-gray-300 rounded-md shadow-sm text-sm">
                @for(role of authService.availableRoles; track role) {
                    <option [value]="role">{{role}}</option>
                }
            </select>
        </div>
        <button class="p-2 rounded-full text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" /></svg>
        </button>
        <div class="relative">
          <img class="h-10 w-10 rounded-full object-cover" ngSrc="https://picsum.photos/100/100" width="40" height="40" alt="User avatar">
        </div>
      </div>
    </header>

    <!-- Page Content -->
    <div class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-100 p-6">
      <router-outlet></router-outlet>
    </div>
  </main>
</div>

<!-- AI Assistant FAB -->
<button (click)="isAiAssistantOpen.set(true)" class="fixed bottom-6 right-6 bg-teal-600 text-white rounded-full p-4 shadow-lg hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 transition-transform hover:scale-110">
  <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 3v1.5M4.5 8.25H3m18 0h-1.5M4.5 12H3m18 0h-1.5m-15 3.75H3m18 0h-1.5M8.25 19.5V21M12 3v1.5m0 16.5V21m3.75-18v1.5M12 8.25h.01M16.5 12h.01M12 15.75h.01M16.5 15.75h.01M16.5 8.25h.01M8.25 15.75h.01M8.25 12h.01" />
  </svg>
</button>

<!-- Global Modals & Notifications -->
@if(uiService.isConfirmationModalOpen()){
    <confirmation-modal 
        [title]="uiService.confirmationTitle()"
        [message]="uiService.confirmationMessage()"
        (confirm)="uiService.confirm()"
        (cancel)="uiService.cancel()"
    ></confirmation-modal>
}
@if(isAiAssistantOpen()) {
  <app-ai-assistant (close)="isAiAssistantOpen.set(false)"></app-ai-assistant>
}

<app-notifications></app-notifications>